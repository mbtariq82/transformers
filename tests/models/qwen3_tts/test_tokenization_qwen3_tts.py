import unittest
import time
import torch
import soundfile as sf
import numpy as np
import io
import urllib.request
from urllib.parse import urlparse
import librosa
from typing import List, Optional, Union
from transformers.models.qwen3_tts.modeling_qwen3_tts import Qwen3TTSTokenizerV2Model, Qwen3TTSTokenizerV2Config
from transformers import AutoFeatureExtractor, AutoProcessor

AudioInput = Union[
    str,  # wav path, or base64 string
    np.ndarray,  # 1-D float array
    List[str],
    List[np.ndarray],
]

class Qwen3TTSTokenizerTest(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        cls.model_id = "Qwen/Qwen3-TTS-Tokenizer-12Hz"
        cls.ref_audio_1 = "https://qianwen-res.oss-cn-beijing.aliyuncs.com/Qwen3-TTS-Repo/tokenizer_demo_1.wav"
        cls.expected_encoding = torch.tensor(
            [
                [1221, 1701,  894, 1626, 1458,  789,  155, 1015,  676,  436, 1998, 1350,
                    8, 1732, 1718, 2035],
                [ 678, 1510,  164, 1449,   69,  975, 1778,  424,  268, 1184,  113,  999,
                1566, 1000,  472, 2009],
                [1925,  143, 1615,  512,  299, 1795, 1778,  359, 1626, 1797,  485, 1301,
                1693,  372,  720, 1630],
                [1925,  285, 1756, 1814, 1390, 1914, 1680,  757, 1662,  629, 1126, 1597,
                1923, 1742, 1061,  986],
                [1029, 1943, 1988,  283,  932, 1760,  501,  530, 1517,  278,  297, 1073,
                135, 1506,   15, 1103],
                [ 695,  254,  597,  448,  862,  981, 1780,   47, 1597,  825, 1222, 1475,
                798, 1975,  720, 1081],
                [ 780,  790, 1132,  101,  467, 1718, 1506, 1019,  626,  393, 1660, 1964,
                155,  325, 1018,  190],
                [ 780,  194, 1501, 1071, 1621, 1094, 1375, 1236, 1405, 1472, 1257, 1386,
                1327, 1880,  781, 1325],
                [ 780, 1408,  969, 1289, 2003,  422, 1675,  253, 1885,  327, 2041,  430,
                972,  732,  121, 1571],
                [ 780, 1932, 1231, 1291,  351, 1881, 1750, 1631,  979, 1171, 1693,  983,
                930,  515,  363,  130],
                [ 993, 1184, 1094,  594,  788, 1718, 1142,  193, 1586,  310,   26,  886,
                937, 1833,  407,  562],
                [ 688,  160,  129, 1178,  193, 2038, 1005,  527, 1528,   58,  204,   66,
                826, 1679,  343,  714],
                [ 700,  213, 1255,  337, 1776, 1296, 1464,  240,  598,  497,  960, 2035,
                839,  992, 1828,  711],
                [1891,  519,   31,  382,  715, 1044, 1893,  621, 1493, 1259, 1425, 1953,
                636,  292,  942,  627],
                [1891,  370,  597,  349, 1785,  171,   68,   31,  713,  388, 1252,  290,
                739,   59,  423,  646],
                [ 605, 1470,  109, 1925,  562,   81,  672, 1397,  796, 1455, 1501, 1276,
                696,  257,  188,  797],
                [  85,  280,  807,  516,  562,  796, 1859, 1970,  509, 1141, 1716, 1436,
                446, 1281, 1452, 1854],
                [ 389,  862, 1542,  615,  140, 1200,  205, 1996, 1435,  588,  750,  605,
                1978, 1226, 1865,  820],
                [1450, 2017, 1564, 1296,  597,  233, 1280,  616,  201, 2039,  521,  310,
                1377,  762,    3,   87],
                [2031, 1808,  538,  244, 1532,  122, 1152, 1879, 1424, 1519, 1585,  549,
                231,  807,  127,  395],
                [1653,  498, 1731, 1633, 1595, 1863, 1043,  304, 2037, 1032, 1203,  880,
                1597,  299, 1755, 1512],
                [1929,  277,  532,  615, 1914,  676,  435, 2013,  701, 1070,   12, 1742,
                210,  403, 1312, 1888],
                [1929, 1028, 1884,  895, 1989, 1162, 1157, 1046,  983,  866,  220, 1277,
                1616, 1974, 1224,  589],
                [ 862, 1963,  437, 1139,    4, 1308,  245, 1166, 2034,  630,  711, 1962,
                1084,  593,  307,  226],
                [1607,  496,  318, 1511,  174, 1476, 1449, 1708,  372, 1747,  296, 1290,
                514, 1711, 1175,  616],
                [1607,  940, 1388, 1849,  745, 1718,  500,  262, 1719, 1663,   77, 1353,
                1686, 1281, 1873, 1207],
                [ 512, 1276,  306, 1212,  836,  453, 2011, 1679,  260,  788, 1384, 1629,
                973,  586,  229, 1347],
                [ 152, 1271,  575, 1970, 1615, 1401,  357,   85, 1185, 1722,  682,  508,
                582,  106,  398, 1648],
                [ 722, 1431,  709,  456,  583,  265, 1801, 1574, 1145, 1224, 1738,  966,
                1728,  179, 1994,  182],
                [ 220,   90, 1376, 1735,   83,  370,  607, 1199, 1646,  535,   55,  152,
                466, 1643,  146, 1141],
                [ 871, 1020,   96, 1126, 1998,  781,  770,  730,   87, 1795, 1480,  256,
                800, 1236,  290, 1245],
                [ 633, 1399,  777, 1890, 1626,  978, 1341, 1601, 1950, 1263,  921, 1161,
                91,  333,  977,  443],
                [ 357,  572, 1510,  855,  747,   95, 1541,  957, 1250, 1229,  689, 1374,
                726,  834,  953, 1113],
                [ 707,  327,  988,  289,  364, 1187, 1245,  309,  464, 1946,   14, 1168,
                1450,  615,  151, 1744],
                [1432, 1602,  525, 1231,  242,  745,  448, 1395,  771, 1568, 1643,  772,
                1405,  208,  163, 1647],
                [ 435, 1666,  207,  404,  129,  741, 1850, 1854, 1400, 1862, 1893, 1022,
                512, 1012, 1069, 1400],
                [ 460,  356, 1142, 1185,  118, 1582, 1834, 1528, 1591, 1515, 1429, 1925,
                173, 1406,  967, 2029],
                [ 530, 1569,  551, 1169, 1320,  895,  984,  227,  594,  337, 1910, 1635,
                1022,  760, 1883, 1643],
                [ 122, 1545,  476, 1468,  858, 1615, 1450,  216, 1732, 1760, 1488, 1906,
                868,  672,  455, 1253],
                [ 122, 1730,  538,  221, 1660, 1872,  613,  686,  775, 1198,  242, 1442,
                1372, 1016,  370,  862],
                [1447, 1132, 1897,  196,  864,  990, 1840,  578,   41,   37, 1354,  366,
                546,  708, 1715, 1998],
                [ 659, 1319,  596,  921,  891,  978, 1040,  371, 1782,   72, 1656, 1029,
                1114, 1117,  632, 1200],
                [2043, 1871, 1826, 1379,   27,  574, 1927,  497,  693, 1120, 1549,  231,
                1651,  473, 1617, 1804],
                [ 531, 1390, 1428, 1385,  666,  451, 1977, 1741, 1078, 1544, 1155,  717,
                497,  372,  653, 1101],
                [ 801,  567,  828, 1742, 1499, 1904, 1893, 1870,  258,  701,  459,  297,
                584, 1397,  389, 1664],
                [ 533, 1909,  755,  969, 2034,    7, 1927, 1870, 1632,  223,  596, 1076,
                220,  581, 1020,  734],
                [1817, 1260, 1613, 1489, 1648,  776, 1399,  297, 1237, 2007,  594, 1022,
                1834, 1064,  647, 1135],
                [1696, 1079, 1243, 1220,  565, 1584,  140, 1721,  790,  493,  367,  410,
                1171, 1818,  343,  337],
                [ 411, 1754, 1582,  462,  711,   41,  572, 1830, 1205, 1693, 1286,  310,
                892, 1328,  307, 1105],
                [ 399, 1008, 1608,  604,  425, 1492,  913, 1208, 1272, 1966, 1156, 1427,
                1459, 1652, 1442, 1462],
                [  38, 1017,  809, 1052,  224,  950, 1891, 1517,  845, 1659, 1811,  455,
                550,  949,   19,  585],
                [ 625,  920, 1512, 1830,  470, 1262,   92,  653,  448,  776, 1253, 1476,
                2022,  194,  855, 1743],
                [ 705, 1242,  875,  426, 1404, 1458,  169, 1396, 1745, 1459,  735,   58,
                1459, 1887,  536, 1883],
                [1570,  676,  564,  462,  410,  978, 1223,  837,  182,  354,  203,  251,
                1876,  485, 1866, 1703],
                [ 302, 1956, 1125, 1940,  413, 1868, 1671,  214,  277,  802,  723,  694,
                1792, 1347, 1314, 1297],
                [ 302, 1625, 1111, 1302, 1801,  236,  572,  521, 1436, 1125, 1700, 1474,
                607, 1173,  775,  247],
                [ 302, 1956,  229, 1210, 1449, 1137,  972, 1154, 1114, 1637, 1310,  342,
                391, 1304, 1337, 1906],
                [1570,  698, 1714, 1931,  570, 1148,  545,  707, 1544,  951,  318, 1930,
                86,  890,  879, 1329],
                [ 700,  829, 1542,  911,  277,   69,  888,  698,  701, 1458, 1565,  751,
                1215,  302, 1042, 1214],
                [ 700,  872,  141, 1767,  914, 1468,  904,  356, 1248,  682, 1655, 1275,
                1580, 1699,   68, 1682],
                [1891, 1299,   79,  704, 1089, 1944, 1983,  665,  983,   14,  475,  294,
                29, 1017,  716, 1711],
                [1891,  441,  124, 1169, 1591, 1099, 1506, 1390, 1721,  455,  106,  608,
                567, 1466,  419,  654],
                [1469,   16, 1028, 1278, 1263, 1848,  943,  658,    6,  497,  745,  249,
                1097, 1421, 1312,  817],
                [1929, 1799,  113,  172,  848,  294,   22,  656,  880,  353, 1485, 1571,
                697,  472,  896,  181],
                [1929,  586,  137,  379,  247, 1555, 1001,  112, 1295,  544,  542,  586,
                1119,  793,  311, 1941],
                [1929, 1347, 2011,  503,   82, 2006,  328,  836,  142, 1060,  462,  229,
                422,  774,  662,  558],
                [1929, 2005, 1656, 1953,  170,  732,  122, 1044, 1386,   19, 1419, 1830,
                1723, 1637,  440, 1561],
                [1929, 1961, 1358, 1777, 1340, 1376, 1582, 1713, 1638,  786, 1611, 2020,
                954, 1505, 1685,  841],
                [1293,  549,  381,  369,  894, 1286, 1808,  422,  907,  531, 1470, 1620,
                1229, 1121,   29,  105],
                [1127,  711, 1433,  678,  303, 1809, 1230,  604, 1382,  419, 1575,  809,
                948,  510,  769,  977],
                [1341,   58, 1155,  958, 1000,  115, 2033, 1982, 1354,  836, 1755, 1151,
                701,  652,   63,  860],
                [2043,  882, 1220,  405, 1547, 1902,  516,  888,  638,  410, 1549, 1228,
                80,  728,   96, 1648],
                [ 531, 1557, 1682,  711, 2043,  122,  121,  589,  937, 1187, 1667, 1177,
                845,  247, 1780,    5],
                [ 531,  997, 1428,  167,  998,  208, 1381,  714, 1575,  165,  926, 1466,
                765, 1357, 1726, 1636],
                [1817, 1779, 1156, 1912,  592, 1382,  852, 1723, 1754,  886, 1072,  805,
                1511, 1730,  453, 1167],
                [ 533,  222, 1322, 1825,  604, 1715,  240,  285,  191,   67,  669, 1457,
                1531, 1816,  498,  644],
                [1705,  480,  342, 1212,   82,  725, 1035,  218,  704,  403, 2033,  432,
                1363,  905, 1430,  129],
                [ 349, 1696,  881, 1676, 1835,  122,  435,  297,  808,  568,  535,   22,
                1025, 1837,  514, 1205],
                [  38, 1506,  675, 1956, 1088, 1489,  708, 1416,   96, 1189,  719, 1286,
                1140,  770, 1850, 1928],
                [  38, 1175,  424, 1062,   41,  521, 1955, 1028, 1348, 1035, 1143,  510,
                339,  900,  454, 1028],
                [1601, 1329, 1951,  839, 1001,  471,  696,  211, 1050, 1501,  989,  283,
                1034, 1488,   86, 1073],
                [1949, 1539, 1763, 1002, 1617, 1314,  622,  596, 2001,  363, 1250, 1035,
                505, 1218,  205,  156],
                [ 643,  400,  207,  116,  118, 2013, 1227,   13,  237,  365,   61,  965,
                1780,  356,  426, 1357],
                [1185,  988,  929,  942,  614, 1172,  235, 1836,   92,  579,   63, 1662,
                704,  613, 1386,   70],
                [ 642, 1813, 1031, 1221,  457, 1272, 1757,  884, 1390, 1428,  292,  101,
                1960,  563, 1896, 1315],
                [ 642, 1331,  664, 1976, 1983,  684,  998,  179, 1884, 1391, 1619, 1426,
                732, 1389,  282, 1102],
                [1728, 1863, 1199,   44,  367, 1053, 1649, 1786, 2035,  285, 1113,  688,
                639,  450,  988,  664],
                [1970, 1701, 1139,   81, 1864,  307, 1683, 1587, 1465, 1645, 1918,  569,
                1471, 1332,  333,  441],
                [ 250,  110, 1473, 1838, 1548, 1649, 1819, 1973, 1489,    6, 1898,  572,
                1664,  525, 1493, 1258],
                [1132,   81, 1307, 1663, 1621,  401,  777,  426, 1771,  320, 1522, 1478,
                1276,  763, 1814, 1551],
                [1597, 1149, 1839,  733, 2023,  562,  146, 1068, 1148, 1655,  155, 1005,
                1187,  329, 1793, 1495],
                [1290, 1827,   91,  872,  291, 1630,  212, 1458, 1908,  988,  689, 1714,
                516, 1683, 1105, 1260],
                [ 340,  796,  256, 1954,  450, 1292,  659, 1126,  571, 1304, 1495, 1115,
                1349,  993, 1066, 1928],
                [ 703, 1899, 1379, 1925,  201, 1547,  117, 1705,  517, 1562,  863, 1843,
                829,  725, 1158, 1898],
                [ 920,  869,  468,  532, 1791, 1232, 1305, 2019, 1685, 1712, 1105, 2023,
                444,  433,  359,  397],
                [1428,  869,  365,  532, 1979,  694,  371,   37, 1413, 1205, 1987,  713,
                1277, 1841, 1675, 1490],
                [1561,  909, 1976, 1923,  900, 1498,  985, 1530, 1266, 1899, 1388, 1799,
                444, 1698, 1707, 1671],
                [1929,  972,   67,  382,  978,  536, 1728,  726,  438,  349,  407, 1213,
                1863, 1833, 1060, 1210],
                [1929,  563,  119, 1800, 1332,  760, 1748, 1422,  730, 1367,  804,  448,
                93, 1809,  408, 1988],
                [1350, 1429,  702, 1911,  488, 1663, 1294,  472,  558, 1101, 1111,  339,
                906,  517, 1017,   96],
                [2008, 1789, 1445,  503, 1837,  195,  885,  640, 1846,  281, 1575, 1589,
                1703, 1283, 1698, 1926],
                [2008,  893, 1936, 1152, 1453,  473, 1035,  221, 1051, 1184,  317,  704,
                1092,  193,  215,  930],
                [ 703, 1223, 1275, 1086,  824,  344,  446,  460,  963,  496,  453,  455,
                898,  965,  895,  322],
                [1438,  549,  629,  712,  989,  266,  212, 1406, 1044,  681, 1263, 1238,
                741, 1103, 1430,  757],
                [ 992, 1312,  368, 1379, 1525, 1101, 1438,  838,  495,   24, 1246, 1586,
                1921, 1901, 1594,  935],
                [ 414,  531, 1864, 1281, 1766, 1242, 1710, 1467, 1072, 1090,  422,  831,
                1831,  698, 1812,   25],
                [ 414,  893,  259, 2018,  372,  394, 1074,  147, 1390, 1705,  695, 1312,
                1410, 1674,  924, 1625],
                [1409, 1752,  824,  340,  579, 2016, 1591,  927,  983,  899,  588,  621,
                732,  299,  214, 1704],
                [1290,  974,  988,   27,  325, 1402, 1092,  262, 1768,  204, 1728,  529,
                962,  299, 1063, 1507],
                [1935, 1294, 1841, 2006, 1783,  924, 1786, 1730,  321,  810, 1479, 1243,
                685, 1880,   17,  841],
                [ 146, 1480,  333, 1926,  254,  903, 1157, 1065,  755, 1009, 1737,  217,
                904, 2006, 1147,  811],
                [ 146, 1017,  585, 1920, 1928,  716,  272, 1990, 1122,  296, 1921, 1731,
                1061, 1321,  335, 1376],
                [ 550,  796,   21,  462, 1662, 1207, 1288, 1828, 1346,  515,  761, 1024,
                1297,  833,  770,  605],
                [ 746,  948, 1790, 1961,   99,  606,  514, 1550,  562,  542,   28, 1768,
                500, 1248, 1902, 1329],
                [1469, 2005,  253, 1172, 1019,  169,  887,  856, 1586,  913, 1508,  622,
                1557,  561, 1968,  792],
                [ 305, 1089,  778,  661, 1089, 1700, 1502, 1600,  564,  765, 1489,  430,
                738,  129, 1771, 1498],
                [1998,  583, 1255, 1231, 1555, 1857,  271, 1244,  696,  216,  514,  389,
                1806, 1481,  901, 1470],
                [1104, 1276, 1563,  167,  407, 1010,  705,  943,  245,  706,  147, 1622,
                1405, 1425, 1473, 1524],
                [ 831, 1039,  530,  349,  788,  161, 1751, 1984,  816, 2030, 1597, 2010,
                1108,  109,  509, 1141],
                [1419, 1485,  235,  604,  925,  864, 1653,  464, 1287, 1318,  599, 1195,
                1978, 1133,  977, 1590],
                [ 302, 1086, 1490, 1249,  295,   86, 1999, 1113, 1720, 1110, 1171, 1038,
                1414, 1742, 1850, 1318],
                [1929,  223,  798,  256, 1115, 1800,  985,  156,  442, 1090, 1974,  153,
                1504,  894, 1349, 1111],
                [1784,  780,  549,  631, 1392, 1308,   33,  896,  965, 1705, 1088, 1609,
                855,  746,  962,  760],
                [1267, 1885, 1342, 1379,  675, 1672,  279,  911, 1707, 1866, 1986, 1732,
                1076, 1553,  625,  108],
                [1267,  874,  722,  286,  494, 1018, 1396, 1796,  833,  644, 1884,  743,
                1940, 1246, 2036, 1760],
                [1306,  614,  453, 2030,  827,  905,  560, 1881,  241, 1722,  799, 1205,
                1160,  559, 1845, 1830],
                [1100, 1666,  355, 1596,  735, 1985, 1048,  145,  930, 1786,  679, 1247,
                1110, 1838,  586,  901],
                [ 609, 1666,  355,  973,  350, 1093,  243, 1527,  480,   38,  743, 1247,
                914, 2027,  586,  901],
                [1841, 1666, 1096,  310,  350, 1093, 1048,  278,  930, 1786,  679,  248,
                783, 1860, 1213, 1668],
                [1841, 1666, 1096,  310, 1296, 1093,  625, 1814,  249, 1144, 1042, 1247,
                783,  889, 1213,  901],
                [ 859, 1666, 1096,  310,  735, 1093,  625, 1814,  930,  905,  743, 1247,
                1108,  889,  586,  901],
                [   2,  957,   15,  241,   76,  326, 1298, 1814, 1351,   38, 1846,  146,
                706,  889, 1772, 1435]
            ],
            dtype=torch.long,
        )
        #cls.config = cls._get_test_config()
        cls.tokenizer = Qwen3TTSTokenizerV2Model.from_pretrained(cls.model_id)
        cls.feature_extractor = AutoFeatureExtractor.from_pretrained(cls.model_id)

    @staticmethod
    def _get_test_config():
        return Qwen3TTSTokenizerV2Config(
            input_sample_rate=16000,
            output_sample_rate=16000,
            encode_downsample_rate=320,
            decode_upsample_rate=320,
            encoder_valid_num_quantizers=4,
            encoder_config={
                "hidden_size": 64,
                "num_layers": 2,
            },
            decoder_config={
                "hidden_size": 64,
                "num_layers": 2,
            },
        )

    def _load_audio(self, x: str, target_sr: int) -> np.ndarray:
        """
        Load audio from url
        """
        with urllib.request.urlopen(x) as resp:
            audio_bytes = resp.read()
        with io.BytesIO(audio_bytes) as f:
            audio, sr = sf.read(f, dtype="float32", always_2d=False)
        if audio.ndim > 1:
            audio = np.mean(audio, axis=-1)
        if sr != target_sr:
            audio = librosa.resample(y=audio, orig_sr=sr, target_sr=target_sr)
        return audio.astype(np.float32)

    def _normalize_audio_inputs(self, audios: AudioInput, sr: Optional[int], target_sr: int = 24000) -> List[np.ndarray]:
        """
        Normalize into a list of 1-D numpy float32 waveforms
        at `self.feature_extractor.sampling_rate`.

        Args:
            audios (AudioInput):
                - str: wav path 
                - np.ndarray: raw waveform (sr must be provided)
                - list[str] / list[np.ndarray]
            sr (Optional[int]):
                Sampling rate for raw numpy input. Required if input is np.ndarray or list[np.ndarray].

        Returns:
            List[np.ndarray]:
                List of float32 waveforms resampled to model input SR.
        """
        if isinstance(audios, (str, np.ndarray)):
            audios = [audios]

        if len(audios) == 0:
            return []

        if isinstance(audios[0], str):
            # wav path list or base64 list
            return [self._load_audio(x, target_sr=target_sr) for x in audios]  # type: ignore[arg-type]

        # numpy list
        if sr is None:
            raise ValueError("For numpy waveform input, you must provide `sr` (original sampling rate).")

        out: List[np.ndarray] = []
        for a in audios:  # type: ignore[assignment]
            if not isinstance(a, np.ndarray):
                raise TypeError("Mixed input types are not supported. Use all paths/base64 or all numpy arrays.")
            if a.ndim > 1:
                a = np.mean(a, axis=-1)
            if int(sr) != target_sr:
                a = librosa.resample(y=a.astype(np.float32), orig_sr=int(sr), target_sr=target_sr)
            out.append(a.astype(np.float32))
        return out

    def test_save_and_load_pretrained(self):
        pass # TODO

    def test_tokenizer_model_init_from_config(self):
        pass # TODO
        #    model = Qwen3TTSTokenizerV2Model(self.config)
        #    self.assertEqual(
        #        model.get_input_sample_rate(),
        #        self.config.input_sample_rate,
        #    )
        #    self.assertEqual(
        #        model.get_output_sample_rate(),
        #        self.config.output_sample_rate,
        #    )
        #    self.assertEqual(
        #        model.get_encode_downsample_rate(),
        #        self.config.encode_downsample_rate,
        #    )
        #    self.assertEqual(
        #        model.get_decode_upsample_rate(),
        #        self.config.decode_upsample_rate,
        #    )

    def test_encoder(self):
        target_sr = int(self.feature_extractor.sampling_rate)
        wavs = self._normalize_audio_inputs(self.ref_audio_1, sr=target_sr)
        inputs = self.feature_extractor(
            raw_audio=wavs,
            sampling_rate=target_sr,
            return_tensors="pt",
        )
        device = getattr(self.tokenizer, "device", None)
        inputs = inputs.to(device).to(self.tokenizer.dtype)
        encoded_frames = self.tokenizer.encode(inputs["input_values"].squeeze(1), inputs["padding_mask"].squeeze(1)).audio_codes[0].cpu()
        assert encoded_frames.shape == self.expected_encoding.shape, (
            f"Shape mismatch: {encoded_frames.shape} vs {self.expected_encoding.shape}"
        )
        assert torch.equal(encoded_frames, self.expected_encoding), (
            "Encoded audio codes do not match hardcoded reference!"
        )

    def test_decoder(self):
        decoded_frames = self.tokenizer.decode(self.expected_encoding.unsqueeze(0))
        wavs = decoded_frames.audio_values[0]

        assert wavs.shape == torch.Size([252885]), (
            f"Shape mismatch: {wavs.shape} vs {torch.Size([252885])}"
        )
        
        # how should i test the contents of wavs (cannot hardcode due to rounding error)


